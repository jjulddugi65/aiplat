<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FOR Pi MAXIMUM TRANSACTION Demo (SDK Integrated - Submission Ready)</title>
    
    <script src="https://cdn.tailwindcss.com/"></script>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    
    <style>
        body { font-family: sans-serif; background-color: #f3f4f6; color: #1f2937; padding: 2rem 1rem; }
        .container { max-width: 1200px; margin: auto; }
        .header { background-color: #1f2937; color: white; padding: 2rem; border-radius: 1rem; }
        .simulator-section { background: white; padding: 2rem; margin: 2rem 0 0 0; border-radius: 1rem 1rem 0 0; box-shadow: 0 2px 15px -5px rgba(0, 0, 0, 0.1); }
        #block_explorer_iframe { width: 100%; height: 150px; border: 2px solid #e5e7eb; border-top: none; border-radius: 0 0 1rem 1rem; display: block; margin-bottom: 2rem; }
        .scp-consensus { font-size: 0.8rem; font-weight: bold; color: white; background: #4f46e5; padding: 0.3rem 0.6rem; border-radius: 0.5rem; white-space: nowrap; opacity: 0; transition: opacity 0.3s; margin-left: 0.5rem; }
        .ledger-header-container { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; }
        .download-button { background-color: #10b981; color: white; padding: 0.3rem 0.6rem; border-radius: 0.5rem; font-size: 0.8rem; font-weight: bold; cursor: pointer; border: none; margin-left: 1rem; transition: background-color 0.2s; }
        .download-button:hover { background-color: #059669; }
        .pi-button { padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: bold; cursor: pointer; border: none; transition: background-color 0.2s; width: 100%; margin-bottom: 1rem; }
        .login-button { background-color: #f7a43b; color: white; }
        .login-button:hover { background-color: #e09133; }
        .payment-button { background-color: #4CAF50; color: white; }
        .payment-button:hover { background-color: #45A049; }
        input[type="number"], select { width: 100%; padding: 0.5rem; margin-top: 0.25rem; border: 1px solid #d1d5db; border-radius: 0.375rem; }
        .pk-cell { font-family: monospace; font-size: 0.65rem; }
        .grid { display: grid; }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .gap-4 { gap: 1rem; }
        .nft-button { background-color: #9c27b0; color: white; padding: 1rem 2rem; border-radius: 0.5rem; font-weight: bold; cursor: pointer; border: none; width: 100%; transition: background-color 0.2s; margin-top: 2rem; }
        .nft-button:hover { background-color: #7b1fa2; }
    </style>
</head>
<body>
    <div id="message_box" style="z-index: 1000; position: fixed; top: 1rem; left: 50%; transform: translateX(-50%) scale(0); transition: transform 0.3s; padding: 0.75rem 1.5rem; border-radius: 0.5rem; color: white; background-color: #1f2937;">
        App Status: Ready
    </div>

    <div class="container">
        <div class="header rounded-xl p-6 md:p-8 flex flex-col md:flex-row items-center justify-between mb-8">
            <div class="flex-1">
                <p class="text-white text-lg font-semibold mb-2">FOR Pi MAXIMUM TRANSACTION</p>
                <p class="text-gray-400 font-bold mb-4">SDK Integrated Demo ‚Äî Submission Ready Version</p>
            </div>
            <div class="md:ml-8 mt-4 md:mt-0">
                <p class="text-white text-sm font-bold text-center">Pi SDK (Sandbox) integrated successfully.</p>
            </div>
        </div>

        <div class="simulator-section">
            <h2 class="text-2xl font-bold mb-4">Transaction Simulation (Pi SDK Sandbox)</h2>
            <div class="grid grid-cols-2 gap-4 mb-4">
                <button id="login_button" class="pi-button login-button" onclick="piAuthenticate()">
                    1. Pi Login (SDK Authenticate)
                </button>
                <button id="payment_button" class="pi-button payment-button" onclick="piRequestPayment()" disabled>
                    2. Request Payment (SDK)
                </button>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label for="piAmount">Pi Amount:</label>
                    <input type="number" id="piAmount" step="0.0001" value="2.5">
                </div>
                <div>
                    <label for="taskType">Task Type:</label>
                    <select id="taskType">
                        <option value="Drawing">Drawing</option>
                        <option value="Animation">Animation</option>
                        <option value="Research">Research</option>
                    </select>
                </div>
            </div>
        </div>

        <iframe id="block_explorer_iframe" src="https://blockexplorer.minepi.com/testnet/" title="Pi Testnet Block Explorer"></iframe>

        <div class="table-container p-6 mb-8 relative bg-white rounded-xl shadow-lg">
            <div class="ledger-header-container">
                <h2 class="text-2xl font-bold text-gray-800">Transaction Ledger (Simulation)</h2>
                <button class="download-button" onclick="downloadLedger()">Download CSV</button>
            </div>
            <table class="min-w-full divide-y divide-gray-200" id="ledger_table">
                <thead>
                    <tr class="bg-gray-50">
                        <th class="px-2 py-2 text-xs">ID</th>
                        <th class="px-2 py-2 text-xs">Time</th>
                        <th class="px-2 py-2 text-xs">Sender</th>
                        <th class="px-2 py-2 text-xs">Amount</th>
                        <th class="px-2 py-2 text-xs">Task</th>
                        <th class="px-2 py-2 text-xs">Status</th>
                    </tr>
                </thead>
                <tbody id="smart_contract_ledger"></tbody>
            </table>
        </div>
    </div>

    <script>
        const APP_KEY = "ms2wkmzsv23ntgjfe0phadfszrs3waaaelusbzuu4iearyfz4qp1oymoyrj0feno";
        let authenticatedUser = null;
        let transactionID = 0;

        function showMessage(message, success = true) {
            const box = document.getElementById("message_box");
            box.textContent = message;
            box.style.backgroundColor = success ? "#4CAF50" : "#F44336";
            box.style.transform = "translateX(-50%) scale(1)";
            setTimeout(() => box.style.transform = "translateX(-50%) scale(0)", 3000);
        }

        function onIncompletePaymentFound(payment) {
            showMessage(`‚ö° Incomplete Payment found: ${payment.identifier}`, false);
        }

        async function piAuthenticate() {
            try {
                const scopes = ['username', 'payments'];
                const user = await Pi.authenticate(scopes, onIncompletePaymentFound);
                authenticatedUser = user.username;
                showMessage(`‚úÖ Authenticated as ${user.username}`, true);
                document.getElementById('login_button').disabled = true;
                document.getElementById('payment_button').disabled = false;
            } catch (err) {
                showMessage("‚ùå Authentication failed: " + err, false);
            }
        }

        function piRequestPayment() {
            if (!authenticatedUser) {
                showMessage("Login first!", false);
                return;
            }
            const amount = parseFloat(document.getElementById('piAmount').value);
            const taskType = document.getElementById('taskType').value;

            showMessage(`üí∞ [SDK Connected] Payment request ready for server approval (mock mode).`, true);

            // Í∏∞Î°ùÏö© ÏãúÎÆ¨Î†àÏù¥ÏÖò
            const ledger = document.getElementById('smart_contract_ledger');
            transactionID++;
            const now = new Date().toLocaleTimeString();
            const row = ledger.insertRow();
            row.innerHTML = `
                <td class="px-2 py-2 text-xs">${transactionID}</td>
                <td class="px-2 py-2 text-xs">${now}</td>
                <td class="px-2 py-2 text-xs">${authenticatedUser}</td>
                <td class="px-2 py-2 text-xs">${amount.toFixed(4)} Pi</td>
                <td class="px-2 py-2 text-xs">${taskType}</td>
                <td class="px-2 py-2 text-xs text-green-600 font-bold">SUCCESS (Mock)</td>
            `;
        }

        function downloadLedger() {
            const table = document.getElementById('ledger_table');
            let csv = [];
            const header = [...table.querySelectorAll('thead th')].map(th => th.innerText);
            csv.push(header.join(','));
            table.querySelectorAll('tbody tr').forEach(tr => {
                const row = [...tr.querySelectorAll('td')].map(td => td.innerText);
                csv.push(row.join(','));
            });
            const blob = new Blob([csv.join('\n')], { type: 'text/csv' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'ledger.csv';
            link.click();
        }

        document.addEventListener("DOMContentLoaded", () => {
            if (window.Pi) {
                Pi.init({
                    version: "2.0",
                    sandbox: true, // ‚úÖ sandbox Î™®ÎìúÎ°ú Î™ÖÏãú (Í≤ÄÏàòÏö©)
                    appKey: APP_KEY
                });
                showMessage("‚úÖ Pi SDK initialized (Sandbox Mode, Submission Ready)", true);
            } else {
                showMessage("‚ùå Pi SDK failed to load.", false);
            }
        });
    </script>
</body>
</html>
